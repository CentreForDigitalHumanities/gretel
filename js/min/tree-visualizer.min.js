!function(a){a.fn.treeVisualizer=function(b,c){function d(){C.initFSOnClick||D.find(".tv-show-fs").on("click",function(a){y.css("top","-100%").children("ul").empty(),void 0!==u&&u.find("a").removeClass("hovered"),F.addClass("tv-fs-open"),r.fadeIn(250,function(){r.children("ol").is("[data-tv-fontsize]")||m()}),a.preventDefault()}),x.on("scroll",function(){n()}),r.on("click",function(b){a(b.target).closest(".tv-error, .tv-content-wrapper").length||(F.removeClass("tv-fs-open"),r.fadeOut(250,function(){t.find("a").removeClass("hovered"),p()}),C.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search))}),z.find("button").on("click",function(){var b=a(this);if(b.is(".tv-close-fs"))F.removeClass("tv-fs-open"),r.fadeOut(250,function(){t.find("a").removeClass("hovered"),p()}),C.initFSOnClick&&history.replaceState("",document.title,window.location.pathname+window.location.search);else{clearTimeout(A),l(b.attr("class").match(/\b(zoom-[^\s]+)\b/)[0]);var c=t.find("a.hovered").css("transition-duration")||200;c=String(c).indexOf("ms")>-1?parseFloat(c):1e3*parseFloat(c),c+=50,A=setTimeout(function(){n(!0)},c)}}),r.find(".tv-navigation-wrapper button").on("click",function(){var b=r.attr("data-tv-active-index"),c=a(".results-ajax-wrapper tbody:not(.empty)");t.find("a").removeClass("hovered"),v.hide(),a(this).is(".tv-prev-tree")?b>0&&b--:b<c.find("tr").length-1&&b++,e(),c.find("tr").eq(b).find("a").click()}),x.on("click","a",function(b){if(!a(this).hasClass("ignored")){var c,d=a(this),e=d.parent("li").data(),f=d.closest(".tv-tree"),g=f.next(".tv-tooltip").children("ul");g.empty(),f.find("a").removeClass("hovered"),d.addClass("hovered");for(c in e)e.hasOwnProperty(c)&&a("<li>",{html:"<strong>"+c+"</strong>: "+e[c]}).prependTo(g);n()}b.preventDefault()}),x.on("mouseout","a.hovered",function(){a(this).closest(".tv-tree").hasClass("small")&&a(this).on("transitionend",function(){n(!0)})}),y.children("button").on("click",function(){var b=a(this).parent(".tv-tooltip");b.fadeOut(250),b.prev(".tv-tree").find("a").removeClass("hovered")})}function e(){r.find(".tv-navigation-wrapper button").prop("disabled",!1);var b=r.attr("data-tv-active-index");b<=0?r.find(".tv-navigation-wrapper .tv-prev-tree").prop("disabled",!0):b>=a(".results-ajax-wrapper tbody:not(.empty)").find("tr").length-1&&r.find(".tv-navigation-wrapper .tv-next-tree").prop("disabled",!0)}function f(){var a=[],c=[],e=[];C.normalView&&(s=D.children("#tree-visualizer"),u=s.find(".tv-tree"),w=u.next(".tv-tooltip"),e.push(s),a.push(u),c.push(w)),r=D.children("#tree-visualizer-fs"),t=r.find(".tv-tree"),v=t.next(".tv-tooltip"),z=r.find(".tv-zoom-opts"),z.prev("a").attr("href",b),e.push(r),a.push(t),c.push(v),x=q(a),y=q(c),anyView=q(e),errorContainer=anyView.children(".tv-error"),""!=C.sentence&&anyView.find(".tv-sentence-wrapper").addClass("has-sentence").children("span").html(C.sentence),C.hasNavigation||r.find(".tv-navigation-wrapper").hide(),anyView.find("*").off(),d()}function g(b){F.addClass("tv-is-loading"),C.initFSOnClick&&F.addClass("tv-fs-open");var c=++G;a.ajax({type:"GET",url:b,dataType:"xml",cache:!1}).done(function(a){null==a||void 0==a?(F.addClass("tv-fail").removeClass("tv-success"),o("Your XML appears to be empty or not in a compatible format.")):(F.addClass("tv-success").removeClass("tv-fail"),c==G&&h(a))}).fail(function(a,b,c){F.addClass("tv-fail").removeClass("tv-success");var d="";0===a.status?d="Not connected to the Internet.<br>Verify your network connection.":404==a.status?d="Requested XML file not found.<br>Try again with another query.":500==a.status?d="Internal Server Error.<br>If the problem persists, contact us.":(d="Something went wrong.<br>Please try again at another time.<br>",d+=a.status+" "+b+" "+c),o(d)}).always(function(){c==G&&F.removeClass("tv-is-loading"),F.hasClass("tv-fail")?a(".continue-btn-wrapper [type='submit']").prop("disabled",!0):a(".continue-btn-wrapper [type='submit']").prop("disabled",!1),C.normalView&&F.addClass("tv-ns-open"),C.initFSOnClick&&r.fadeIn(250,function(){m()})})}function h(b){var c=a(b);p(),x.html(i(c.find("node").first())),y.children("ul").empty();var d=a("<table>");c.find("metadata").children("meta").sort(function(a,b){return a.getAttribute("name").localeCompare(b.getAttribute("name"))}).each(function(b,c){var e=a("<tr>"),f=a("<th>");f.append(c.getAttribute("name")),e.append(f);var g=a("<td>");g.append(c.getAttribute("value")),e.append(g),d.append(e)}),a(document).tooltip({items:".fa-commenting",content:d}),j()}function i(b){var c=a("<ol/>");return b.each(function(b,d){for(var e=a('<li><a href="#"></a></li>'),f=0,g=d.attributes.length,h=null;f<g;f++)h=d.attributes[f],"highlight"==h.nodeName?e.addClass("highlight"):"not"==h.nodeName?e.addClass("excluded"):"begin"!=h.nodeName&&"end"!=h.nodeName&&e.attr("data-"+h.nodeName,h.value.replace(/^\s(.+)/,"$1"));a(this).children("node").length&&e.append(i(a(this).children("node"))),c.append(e)}),c}function j(){x.find("a").each(function(){var b=a(this),c=b.parent("li");if(F.hasClass("matrix")&&c.data("word")&&(c.data("caseinsensitive")?(c.data("word",c.data("word").toLowerCase()),c.data("lemma",c.data("lemma").toLowerCase())):b.addClass("cs")),c.data("rel")&&(b.append("<span class='rel'>"+c.data("rel")+"</span>"),c.data("index")&&b.append("<span class='index'>"+c.data("index")+"</span>")),c.data("postag")&&C.extendedPOS?b.append("<span class='postag'>"+c.data("postag")+"</span>"):c.data("pt")?c.data("index")?b.children("span:last-child").append(":"+c.data("pt")):b.append("<span class='pt'>"+c.data("pt")+"</span>"):c.data("cat")&&(" "==c.data("cat")?(c.removeAttr("data-cat"),c.removeData("cat"),b.addClass("ignored").text("?").attr("title","Top node's properties will be ignored")):c.data("index")?b.children("span:last-child").append(":"+c.data("cat")):b.append("<span class='cat'>"+c.data("cat")+"</span>")),b.is(":only-child")){if(c.data("lemma")&&c.append("<span class='lemma'>"+c.data("lemma")+"</span>"),c.data("word")){var d=F.hasClass("matrix")&&!c.data("caseinsensitive")?' title="Case sensitive word"':"";c.append("<span class='word'><em"+d+">"+c.data("word")+"</em></span>")}b.addClass("only-child")}c.data("caseinsensitive")&&(c.removeAttr("data-caseinsensitive"),c.removeData("caseinsensitive"))}),x.find("li:only-child").addClass("only-child"),x.find("li:first-child").addClass("first-child"),x.find("li:last-child").addClass("last-child")}function k(){var a=parseInt(t.children("ol").css("fontSize"),10),b=t.children("ol").attr("data-tv-fontsize");z.find("button").prop("disabled",!1),t.removeClass("tv-small tv-x-small"),a<=4?(z.find("button.tv-zoom-out").prop("disabled",!0),t.children("ol").css("fontSize","4px")):a>=16&&z.find("button.tv-zoom-in").prop("disabled",!0),a==b&&z.find("button.tv-zoom-default").prop("disabled",!0),a<=8&&(t.addClass("tv-small"),a<=4&&t.addClass("tv-x-small"))}function l(a){if("zoom-default"==a)t.children("ol").is("[data-tv-fontsize]")?t.children("ol").css("fontSize",t.children("ol").attr("data-tv-fontsize")+"px"):m();else{var b=parseInt(t.children("ol").css("fontSize"),10);"zoom-in"==a?t.children("ol").css("fontSize",b+2+"px"):"zoom-out"==a&&t.children("ol").css("fontSize",b-2+"px")}k()}function m(){for(var a=parseInt(t.children("ol").css("fontSize"),10),b=t[0];a>4&&(b.scrollHeight>b.clientHeight||b.scrollWidth>b.clientWidth);)a--,t.children("ol").css("fontSize",a+"px");for(;a<16&&b.scrollHeight<=b.clientHeight&&b.scrollWidth<=b.clientWidth;)if(a++,t.children("ol").css("fontSize",a+"px"),b.scrollHeight>b.clientHeight||b.scrollWidth>b.clientWidth){a--,t.children("ol").css("fontSize",a+"px");break}t.children("ol").attr("data-tv-fontsize",a),k()}function n(a){var b;if(void 0!==t&&F.hasClass("tv-fs-open")?b=t:void 0!==u&&F.hasClass("tv-ns-open")&&(b=u),void 0!==b){var c=b.find("a.hovered");if(c.length){var d=b.next(".tv-tooltip"),e=c[0].getBoundingClientRect(),f=b[0].getBoundingClientRect(),g={right:E.outerWidth()-e.right,bottom:E.outerHeight()-e.bottom},h={right:E.outerWidth()-f.right,bottom:E.outerHeight()-f.bottom},i={left:parseInt(e.left+e.width/2-d.outerWidth()/2+8,10)+"px",top:parseInt(e.top-d.outerHeight()-24,10)};a?d.stop(!0).animate({left:i.left,top:i.top},250):d.css({left:i.left,top:i.top}),e.left+e.width/2<f.left||g.right+e.width/2<h.right||e.top+e.height/2<f.top||g.bottom+e.height<h.bottom?d.fadeOut(400):d.fadeIn(250)}}}function o(a){errorContainer.children("p").html(a),C.normalView&&s.children(".tv-show-fs").prop("disabled",!0)}function p(){C.normalView&&s.children(".tv-show-fs").prop("disabled",!1)}function q(b){return a(a.map(b,function(a){return a.get()}))}var r,s,t,u,v,w,x,y,z,A,B={normalView:!0,sentence:"",initFSOnClick:!1,extendedPOS:!1,hasNavigation:!1},C=a.extend({},B,c),D=this,E=a(window),F=a("body"),G=0;f(),g(b),e(),E.on("scroll",function(){n()})}}(jQuery);