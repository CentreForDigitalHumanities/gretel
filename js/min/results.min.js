$(function(){function a(){!z&&x<=phpVars.resultsLimit&&($(".loading-wrapper.searching").addClass("active"),l=$.ajax(phpVars.fetchResultsPath).done(function(a){if(!z&&!B){var b=$.parseJSON(a);!b.error&&b.data?(s.find("tbody.empty").hide(),h(b.data,!1)):($(".loading-wrapper.searching").removeClass("active"),v.closest(".results-messages-wrapper").addClass("active"),u.addClass("active"),b.error?g(b.data):0==s.find("tbody:not(.empty)").children().length?f():e(),clearTimeout(C),z=!0,B=!0,k&&k.abort(),m&&m.abort())}}).fail(function(a,b,c){if("abort"!=c){var d="An error occurred";""!=c&&(d+=": "+c+"."),g(d)}}).always(function(){x!=o||z||B||b()}))}function b(){k||(clearTimeout(C),k=$.ajax(phpVars.getAllResultsPath).done(function(a){var b=$.parseJSON(a);!b.error&&b.data?(s.find("tbody.empty").hide(),h(b.data,!0)):($(".loading-wrapper.searching").removeClass("active"),v.children("div").removeClass("error notice").closest(".results-messages-wrapper").show(),u.addClass("active"),b.error?g(b.data):0==s.find("tbody:not(.empty)").children().length&&f())}).fail(function(a,b,c){if("abort"!=c){g("An error occurred: "+c+".")}}).always(function(){z=!0,l&&l.abort()}))}function c(){m=$.ajax(phpVars.fetchCountsPath).done(function(a){var b=$.parseJSON(a);if(!b.error&&b.sum&&b.counts){var c=b.sum,e=b.counts;if(y=c,c=d(parseInt(c)),r.find(".count strong + span").text(c),v.find(".amount-hits").text(c),v.find(".is-still-counting").remove(),q.removeClass("counts-loading"),q.addClass("counts-done"),y>0){var f=Object.keys(e).length;if(void 0!==e&&f>0){var g=0,h=0;for(var i in e){var j=i.split("_")[2],k=d(parseInt(e[i][0])),l=d(parseInt(e[i][1]));g+=parseInt(e[i][0]),h+=parseInt(e[i][1]),u.find(".distribution-wrapper tbody").append("<tr><td>"+j+"</td><td>"+k+"</td><td>"+l+"</td></tr>")}u.find(".distribution-wrapper tbody").append("<tr><th>Total</th><th>"+d(g)+"</th><th>"+d(h)+"</th></tr>"),u.find(".distribution-wrapper").show()}y>phpVars.resultsLimit&&v.find(".is-restricted").show()}}}).fail(function(a,b,c){if("abort"!=c){g("An error occurred: "+c+".")}}).always(function(){A=!0})}function d(a){return Number.isInteger(a)&&a>999?a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,"):a}function e(){i(),q.removeClass("results-loading").addClass("results-done"),v.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php?sid="+phpVars.sid+" #results-found",function(){A&&(v.find(".amount-hits").html(d(parseInt(y))),v.find(".is-still-counting").remove()),x<phpVars.resultsLimit&&(null!=m&&(m.abort(),m=null),countString=r.find(".count strong").text(),r.find(".count strong + span").text(countString),v.find(".amount-hits").text(countString),v.find(".is-still-counting").remove()),v.children("div").removeClass("error").addClass("notice active").closest(".results-messages-wrapper").show(),u.addClass("active"),w.show()})}function f(){q.removeClass("results-loading").addClass("results-none"),u.addClass("no-results"),q.addClass("search-no-results"),v.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #no-results-found",function(){v.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function g(a){q.removeClass("results-loading").addClass("results-failed"),s.add(r).remove(),u.addClass("error"),q.addClass("search-error"),v.load(phpVars.fetchHomePath+"/front-end-includes/results-messages.php #error",function(){v.find(".error-msg").text(a).after('<p>If this error persists, please do not hesitate to <a href="documentation.php#faq-4" title="How can you contact us?">contact us</a>!</p>'),v.children("div").removeClass("notice").addClass("error active").closest(".results-messages-wrapper").show()})}function h(b,c){c&&(z=!0,x=0,s.find("tbody:not(.empty)").empty()),$.each(b,function(a,b){if(c||!c&&!z){x++;var d=b[0];d=d.replace(/\bhref=\"([^"]+)\"/,'href="#tv-'+x+'" data-tv-url="$1"'),s.find("tbody:not(.empty)").append('<tr data-result-id="'+x+'" data-component="'+b[2]+'"><td>'+x+"</td><td>"+d+"</td><td>"+b[2]+"</td><td>"+b[1]+"</td></tr>")}}),resultIDString=d(parseInt(x)),r.find(".count strong").text(resultIDString),c||z?e():a()}function i(){$("[for='filter-components'], .filter-sel-wrapper label").removeClass("disabled").children("input").prop("disabled",!1),t.find("[type='checkbox'][name='component']").each(function(a,b){var c=$(b),d=c.val();0==s.find("tbody:not(.empty) tr[data-component^='"+d+"']").length&&(c.prop("disabled",!0),c.prop("checked",!1),c.parent("label").addClass("disabled"))})}function j(){null!=k&&(k.abort(),k=null),null!=m&&(m.abort(),m=null),null!=l&&(l.abort(),l=null),z=!0}var k,l,m,n=500,o=4,p=(window.location.hash,$(window),$(document)),q=$("body"),r=$(".controls"),s=$(".results-ajax-wrapper"),t=$(".filter-sel-wrapper"),u=$("#download-overview .flex-content"),v=u.find(".messages"),w=$(".notification-wrapper"),x=0,y=0,z=!1,A=!1,B=!1;a(),c(),q.addClass("results-loading counts-loading");var C=setTimeout(function(){b()},n);p.click(function(a){if(r.find(".filter-wrapper").hasClass("active")){$(a.target).closest(".filter-wrapper").length||r.find(".filter-wrapper").removeClass("active")}}),r.find("[for='filter-components']").click(function(){$(this).parent().addClass("active")}),r.find("[for='filter-metadata']").click(function(){$(this).parent().addClass("active")}),t.find("[type='checkbox']").change(function(){var a=$(this),b=a.val();$("#all-components").prop("indeterminate",!1),a.is("[name='component']")?(a.is(":checked")?s.find("tbody:not(.empty) tr[data-component^='"+b+"']").show():s.find("tbody:not(.empty) tr[data-component^='"+b+"']").hide(),t.find("[name='component']").is(":checked")?(t.find("[name='component']:not(:disabled)").length==t.find("[name='component']:not(:disabled):checked").length?t.find("#all-components").prop("checked",!0).parent().addClass("active"):t.find("#all-components").prop("checked",!1).prop("indeterminate",!0).parent().removeClass("active"),s.find(".empty").hide()):(s.find(".empty").css("display","table-row-group").find("td").text("No results matching the specified filters"),t.find("#all-components").prop("checked",!1).parent().removeClass("active"))):a.is("#all-components")&&(a.parent().toggleClass("active"),t.find("[type='checkbox'][name='component']:not(:disabled)").prop("checked",a.is(":checked")).change())}),window.addEventListener("beforeunload",function(){j()}),$(".secondary-navigation a").click(function(){j()}),s.find("tbody").on("click","a.tv-show-fs",function(a){var b=$(this),c=b.parent().nextAll("td:last-child").html(),d=$("#tree-visualizer-fs");s.find("tbody a").removeClass("tv-toggled-link"),this.hasAttribute("data-tv-fontsize")||b.attr("data-tv-fontsize",0),d.attr("data-tv-active-index",b.closest("tr").index()),b.addClass("tv-toggled-link"),q.treeVisualizer(b.data("tv-url"),{normalView:!1,initFSOnClick:!0,sentence:c,hasNavigation:!0}),a.preventDefault()}),w.find("button").click(function(){w.hide()}),w.find("a").click(function(a){a.preventDefault(),$("html, body").stop().animate({scrollTop:$("#download-overview").offset().top},150),w.fadeOut("fast")}),$("#results-menu a").off("click").click(function(a){$("html, body").stop().animate({scrollTop:$($(this).attr("href")).offset().top},150),a.preventDefault()})});