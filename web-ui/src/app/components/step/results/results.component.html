<div class="columns is-desktop">
    <!-- XPATH -->
    <div class="column">
        <h2 class="subtitle">
            <div class="level">
                <div class="level-left">
                    XPath
                </div>
                <div class="level-right is-hidden-print">
                    <div class="level-item">
                        <div class="field has-addons">
                            <ng-container *ngIf="isModifyingXPath">
                                <p class="control">
                                    <a class="button is-primary" role="button" [attr.disabled]="!validXPath ? true : null"
                                        grtBalloonPosition="down" grtBalloon="Save query" (click)="updateXPath()">
                                        <span class="icon is-large">
                                            <i class="fas fa-check"></i>
                                        </span>
                                    </a>
                                </p>
                                <p class="control">
                                    <a class="button" role="button" grtBalloonPosition="down" grtBalloon="Reset query"
                                        (click)="resetXPath()">
                                        <span class="icon is-large">
                                            <i class="fas fa-undo"></i>
                                        </span>
                                    </a>
                                </p>
                            </ng-container>
                            <ng-container *ngIf="!isModifyingXPath">
                                <p class="control">
                                    <a class="button" role="button" grtBalloonPosition="down" grtBalloon="Edit query"
                                        (click)="editXPath()">
                                        <span class="icon is-large">
                                            <i class="fas fa-edit"></i>
                                        </span>
                                    </a>
                                </p>
                                <p class="control">
                                    <a class="button" role="button" grtBalloonPosition="down" grtBalloon="Download query"
                                        (click)="downloadXPath()">
                                        <span class="icon is-large">
                                            <i class="fas fa-download"></i>
                                        </span>
                                    </a>
                                </p>
                                <p class="control">
                                    <a class="button" role="button" grtBalloonPosition="down-right" grtBalloon="Copy query to the clipboard"
                                        (click)="copyXPath()" [ngClass]="{'is-success': xpathCopied }">
                                        <span class="icon is-large">
                                            <i class="fas fa-copy"></i>
                                        </span>
                                    </a>
                                </p>
                            </ng-container>
                        </div>
                    </div>
                    <div class="level-item" *ngIf="isFiltering">
                        <div class="field">
                            <p class="control">
                                <a class="button" role="button" grtBalloonPosition="down" grtBalloon="Modify the XPath to include the specified filters."
                                    (click)="addFiltersXPath()">
                                    <span class="is-large">
                                        <i class="fas fa-plus"></i>
                                        <i class="fas fa-filter"></i>
                                    </span>
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </h2>
        <div class="xpath">
            <div class="content" *ngIf="!isModifyingXPath">
                <grt-xpath-viewer (click)="editXPath()" [value]="xpath"></grt-xpath-viewer>
                <em *ngIf="inputSentence">Based on: &ldquo;{{inputSentence}}&rdquo;</em>
            </div>
            <grt-xpath-editor *ngIf="isModifyingXPath" width="100%" [value]="xpath" (onChange)="customXPathChanged($event)"
                autofocus="true"></grt-xpath-editor>
        </div>
    </div>
    <!-- DISTRIBUTION LIST -->
    <div class="column">

        <h2 class="subtitle">
            <div class="level">
                <div class="level-item level-left">
                    Components
                </div>
                <div class="level-item level-right is-hidden-print">
                    <div class="field">
                        <p class="control">
                            <a class="button" grtBalloonPosition="left" grtBalloon="Download distribution list (.csv)" [ngClass]="{'is-loading': loading}" (click)="downloadDistributionList()">
                                <span class="icon is-large">
                                    <i class="fas fa-download"></i>
                                </span>
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Hits</th>
                    <th>All Sentences</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let provider of resultSummary | keyvalue">
                    <ng-container *ngFor="let corpus of provider.value | keyvalue">
                        <tr>
                            <th>
                                <label class="checkbox">
                                    <input type="checkbox" [checked]="corpus.value.show" (change)="toggleCorpus(provider.key, corpus.key)" /> {{corpus.key}}
                                </label>
                            </th>
                            <th>{{corpus.value.hits.length}}</th>
                            <th>{{corpus.value.totalSentences}}</th>
                        </tr>
                        <ng-container *ngIf="corpus.value.show">
                            <tr *ngFor="let component of corpus.value.components | keyvalue">
                                <td>
                                    <label class="checkbox">
                                        <input type="checkbox" [checked]="component.value.show" (change)="toggleComponent(provider.key, corpus.key, component.key)" /> {{component.key}}
                                    </label>
                                </td>
                                <td>{{component.value.hits}}</td>
                                <td>{{component.value.sentences}}</td>
                            </tr>
                        </ng-container>
                        <tr></tr> <!-- spacer row -->
                    </ng-container>
                </ng-container>
            </tbody>
            <tfoot>
                <tr>
                    <td>
                        <!--

                            <label class="checkbox">
                                <input type="checkbox" [checked]="totalSelected" (change)="toggleAllComponents(!totalSelected)" /> Total
                            </label>
                        -->
                    </td>
                    <td>{{totalHits}}</td>
                    <td>{{totalSentences.toString()}}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>
<div class="level">
    <div class="level-left">
        <h1 class="title" [ngClass]="{'is-loading': loading}">
            Results: {{filteredResults.length}}<ng-container *ngIf="(totalHits - filteredResults.length) > 0"> ({{totalHits - filteredResults.length}} hidden)</ng-container>
        </h1>
    </div>
    <div class="level-right is-hidden-print">
        <div class="level-item">
            <div class="field">
                <p class="control">
                    <a class="button" role="button" (click)="prev.next()">
                        Previous
                    </a>
                </p>
            </div>
        </div>
        <div class="level-item" *ngIf="!loading">
            <div class="field has-addons">
                    <p class="control">
                        <a class="button" role="button" [ngClass]="{'is-loading':loading}" (click)="downloadResults()" grtBalloonLength="large" grtBalloonPosition="down" grtBalloon="Download the results as a .csv-file">
                            <span class="icon is-large">
                                <i class="fas fa-download"></i>
                            </span>
                        </a>
                    </p>
                    <p class="control">
                        <a class="button" role="button" (click)="downloadFilelist()" grtBalloonLength="large" grtBalloonPosition="down" grtBalloon="Download the names of the files in a filelist (.fl)">
                            <span class="icon is-large">
                                <i class="fas fa-file-alt"></i>
                            </span>
                        </a>
                    </p>
                </div>
            </div>
        <div class="level-item">
            <div class="field">
                <p class="control" grtBalloonPosition="down" grtBalloon="Print Results" [grtBalloonVisible]="loading ? false : undefined">
                    <a class="button" role="button" [ngClass]="{'is-loading':loading}" (click)="print()">
                        <span class="icon is-large">
                            <i class="fas fa-print"></i>
                        </span>
                    </a>
                </p>
            </div>
        </div>
        <div class="level-item">
            <div class="field">
                <p class="control" (click)="toggleContext()">
                    <a class="button is-warning" role="button" grtBalloonLength="large" grtBalloonPosition="down"
                        grtBalloon="Click to show the sentences directly before and after the hits." *ngIf="!retrieveContext">
                        <span class="icon is-large">
                            <i class="fas fa-comment-slash"></i>
                        </span>
                    </a>
                    <a class="button is-primary" role="button" grtBalloonLength="large" grtBalloonPosition="down"
                        grtBalloon="Click to hide the sentences surrounding the hits." *ngIf="retrieveContext">
                        <span class="icon is-large">
                            <i class="fas fa-comment-dots"></i>
                        </span>
                    </a>
                </p>
            </div>
        </div>
        <div class="level-item">
            <div class="field">
                <p class="control">
                    <a class="button is-primary" role="button" (click)="next.next()">
                        Next
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
<grt-filters-by-xpath [filters]="filterXPaths" (delete)="deleteFilter($event)"></grt-filters-by-xpath>
<div class="columns">
    <div *ngIf="filters && filters.length" class="column is-one-third is-hidden-print">
        <div class="filter">
            <grt-filters [filters]="filters" [filterValues]="filterValues" (filterChange)="filterChange($event)"></grt-filters>
        </div>
    </div>
    <div class="column">
        <p-table *ngIf="filteredResults.length > 0 else warning" [columns]="columns" [value]="filteredResults" [resizableColumns]="true" styleClass="bulma">
            <ng-template pTemplate="colgroup" let-columns>
                <colgroup>
                    <col *ngFor="let col of columns" [style.width]="col.width">
                </colgroup>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" pResizableColumn>
                        {{col.header}}
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns" let-i="rowIndex">
                <tr>
                    <td *ngFor="let col of columns" class="ui-resizable-column">
                        <div [ngSwitch]="col.field">
                            <span *ngSwitchCase="'number'">{{i + 1}}</span>

                            <ng-container *ngSwitchCase="'fileId'">
                                <a *ngIf="rowData[col.field]; else fileIdButton" (click)="showTree(rowData)">{{rowData[col.field]}}</a>
                                <ng-template #fileIdButton>
                                    <button type="button" class="button" (click)="showTree(rowData)">Show tree</button>
                                </ng-template>
                            </ng-container>

                            <span [innerHTML]="rowData[col.field]" *ngSwitchDefault></span>
                        </div>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <ng-template #warning>
            <div *ngIf="!loading" class="notification is-warning">No results found, please try again with another
                treebank or other xpath-query</div>
        </ng-template>
    </div>
</div>
<grt-tree-visualizer *ngIf="treeXml" [sentence]="treeSentence" [xml]="treeXml" [url]="treeXmlUrl" display="fullscreen"></grt-tree-visualizer>
